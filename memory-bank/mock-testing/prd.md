# PRD: 測試模式隔離增強

## 產品需求文件

### 功能概述
**功能名稱**: Test Mode Isolation Enhancement（測試模式隔離增強）  
**功能描述**: 改善現有的「🧪 測試加入」功能，讓測試任務完全隔離，不對外發送真實請求，提供完整的模擬處理流程  
**優先級**: 高  
**預估工期**: 3-5 天  

### 問題陳述

#### 現況問題
1. **測試不完整**: 目前的「🧪 測試加入」只是加入假任務到隊列，但實際處理時仍會對外發送真實請求
2. **無法隔離測試**: 測試任務會消耗真實的 API 配額和網路資源
3. **測試風險**: 測試過程可能影響外部服務或產生不必要的費用
4. **開發不便**: 無法在離線或受限環境中測試完整流程
5. **調試困難**: 無法快速驗證處理邏輯而不等待真實 API 回應

#### 影響範圍
- **開發體驗**: 無法安全地測試完整工作流程
- **成本控制**: 測試消耗生產 API 配額
- **系統穩定性**: 測試可能對外部服務造成負擔

### 解決方案

#### 核心目標
1. **完全隔離**: 測試模式下完全不對外發送請求
2. **快速處理**: 測試任務在 2-3 秒內完成整個流程
3. **真實模擬**: 模擬結果接近真實處理流程的輸出
4. **易於使用**: 一鍵切換測試模式，操作簡單
5. **安全可靠**: 零成本、零風險的測試環境

#### 功能需求

##### F1: 測試模式切換
- **F1.1**: 在 Streamlit 介面加入測試模式開關
- **F1.2**: 測試模式下所有外部請求被攔截並模擬
- **F1.3**: 清楚顯示當前是否為測試模式
- **F1.4**: 測試模式可以快速開啟/關閉

##### F2: 模擬處理管道
- **F2.1**: YouTubeDownloader 模擬
  - 模擬下載過程，返回預設的樣本音訊檔案
  - 模擬處理時間（1-2 秒）
  - 返回假的但合理的檔案路徑和元資料
- **F2.2**: Transcriber 模擬  
  - 模擬語音轉錄，返回預設的轉錄文字
  - 模擬處理時間（1 秒）
  - 支援不同長度和類型的樣本轉錄
- **F2.3**: Summarizer 模擬
  - 模擬 AI 摘要生成，返回預設的摘要內容
  - 模擬處理時間（1 秒）
  - 支援不同風格的樣本摘要
- **F2.4**: Storage 模擬
  - 模擬檔案保存操作
  - 模擬 Notion 上傳操作
  - 返回假的但合理的檔案路徑

##### F3: 樣本資料管理
- **F3.1**: 準備多種類型的樣本資料
  - 技術教學類樣本
  - 新聞報導類樣本  
  - 播客對話類樣本
  - 短片摘要類樣本
- **F3.2**: 動態樣本選擇
  - 根據 URL 模式選擇不同樣本
  - 支援隨機樣本選擇
  - 樣本輪換機制

##### F4: 視覺化增強
- **F4.1**: 測試模式標示
  - 明顯的視覺提示顯示測試模式
  - 測試任務與真實任務的區別標示
- **F4.2**: 處理過程模擬
  - 進度條正常顯示
  - 各階段狀態更新
  - 模擬的處理時間顯示

#### 非功能需求

##### 效能需求
- **NFR1**: 測試模式下任務處理時間 2-3 秒
- **NFR2**: 模式切換響應時間 < 500ms
- **NFR3**: 樣本資料載入時間 < 100ms

##### 可用性需求
- **NFR4**: 一鍵切換測試/正常模式
- **NFR5**: 清楚的視覺提示區分測試模式
- **NFR6**: 測試模式下的操作與正常模式保持一致

##### 可靠性需求
- **NFR7**: 測試模式下絕對不會發送外部請求
- **NFR8**: 測試資料格式與真實資料保持一致
- **NFR9**: 測試模式不影響正常功能的穩定性

### 成功指標

#### 量化指標
1. **處理速度**: 測試任務完成時間 2-3 秒（vs 原本 30-60 秒）
2. **隔離效果**: 測試模式下 0 次外部請求
3. **使用便利性**: 3 次點擊內可切換模式並執行測試
4. **樣本覆蓋**: 提供至少 5 種不同類型的樣本資料

#### 質化指標
1. **使用體驗**: 測試模式操作感受與正常模式一致
2. **開發效率**: 可以快速驗證功能邏輯
3. **安全性**: 完全隔離，無意外外部請求風險

### 約束條件

#### 技術約束
- 必須與現有的動態隊列系統相容
- 不能破壞現有的正常處理流程
- 樣本資料格式必須與真實資料一致
- 保持 Streamlit 介面的響應性

#### 資源約束
- 開發時間: 3-5 天
- 樣本資料大小: < 50MB
- 不新增外部依賴套件

#### 相容性約束
- 支援現有的 Docker 環境
- 保持向下相容性
- 不影響現有的測試按鈕功能

### 風險評估

#### 高風險
- **模擬不真實**: 模擬的處理結果與真實結果差異過大
- **模式混淆**: 使用者可能不清楚當前是否在測試模式

#### 中風險
- **性能影響**: 切換機制可能影響正常模式的性能
- **維護負擔**: 樣本資料需要定期更新

#### 風險緩解策略
1. 使用真實場景的資料作為樣本基礎
2. 提供明顯的視覺標示區分模式
3. 簡化切換機制，避免複雜的邏輯
4. 建立樣本資料的版本管理

### 驗收標準

#### 主要驗收標準
1. ✅ 測試模式開關正常運作
2. ✅ 測試模式下完全不發送外部請求
3. ✅ 測試任務在 2-3 秒內完成
4. ✅ 模擬結果格式與真實結果一致
5. ✅ 提供至少 5 種不同的樣本資料

#### 次要驗收標準
1. ✅ 測試模式有明顯的視覺標示
2. ✅ 切換模式操作簡單直觀
3. ✅ 不影響現有功能的正常運作
4. ✅ 提供基本的使用說明

---

**備註**: 此功能將讓現有的測試按鈕更加完善，提供安全、快速的測試環境，讓開發者可以放心地測試功能而不用擔心對外部服務造成影響。